{% extends 'base.html.twig' %}

{% block title %}Panneau d'administration{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {# Assurez-vous d'inclure le fichier CSS ici #}
    <link rel="stylesheet" href="{{ asset('styles/admin.css') }}">
{% endblock %}

{% block top_header_content %}
    {{ parent() }}
{% endblock %}

{% block bottom_header_content %}
    {# Ce bloc est laissé vide pour ne pas afficher le contenu #}
{% endblock %}

{% block body %}
<main class="admin-dashboard">
    <h1>Tableau de bord administrateur</h1>

    <div class="admin-section">
        <h2>Utilisateurs ({{ users|length }})</h2>
        {# Bouton pour basculer la liste des utilisateurs (la liste est cachée par défaut) #}
        <button id="toggle-users" class="btn-toggle btn-secondary btn-sm mb-3">Afficher la liste</button>
        
        <ul class="admin-list" id="user-list" style="display: none;">
            {% for user in users %}
                <li>
                    {# Affichage du nom, email et rôle (en rouge si admin) #}
                    <span>
                        {{ user.username }} ({{ user.email }}) 
                        {% if 'ROLE_ADMIN' in user.roles %}
                            <strong style="color: #F9780D;">(ADMIN)</strong>
                        {% endif %}
                    </span>
                    <div class="admin-actions">
                        
                        <a href="{{ path('app_user_profile', {'id': user.id}) }}" class="btn btn-info btn-sm">Voir profil</a>
                        
                        {# Bouton Supprimer l'utilisateur (ROUGE) #}
                        <form method="post" action="{{ path('app_user_delete_admin', {'id': user.id}) }}" style="display:inline-block" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ? Cette action est irréversible.');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
                            <button class="btn btn-action-delete btn-sm">Supprimer</button>
                        </form>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>

    <div class="admin-section">
        <h2>Événements ({{ events|length }})</h2>
        {# Bouton pour basculer la liste des événements (la liste est cachée par défaut) #}
        <button id="toggle-events" class="btn-toggle btn-secondary btn-sm mb-3">Afficher la liste</button>
        
        <ul class="admin-list" id="event-list" style="display: none;">
            {% for event in events %}
                <li>
                    <span>{{ event.title }}</span>
                    <div class="admin-actions">
                        <a href="{{ path('app_event_show', {'id': event.id}) }}" class="btn btn-info btn-sm">Voir</a>
                        <a href="{{ path('app_event_edit', {'id': event.id}) }}" class="btn btn-warning btn-sm">Modifier</a>
                        
                        {# Bouton Supprimer l'événement (ROUGE) #}
                        <form method="post" action="{{ path('app_event_delete', {'id': event.id}) }}" style="display:inline-block" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet événement ?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ event.id) }}">
                            <button class="btn btn-action-delete btn-sm">Supprimer</button>
                        </form>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>
</main>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {# Assurez-vous que votre fichier admin.js existe pour la bascule des listes #}
    <script src="{{ asset('js/admin.js') }}"></script>
{% endblock %}