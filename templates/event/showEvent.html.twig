{% extends 'base.html.twig' %}

{% block title %}D√©tails de l'√©v√©nement{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('styles/style.css') }}">
{% endblock %}

{% block top_header_content %}
    {{ parent() }}
{% endblock %}

{% block bottom_header_content %}
    {# Ce bloc est laiss√© vide pour ne pas afficher le contenu #}
{% endblock %}

{% block body %}
<main class="event-details-page">
    <h1>{{ event.title }}</h1>
    <img src="{{ asset(event.image) }}" alt="Image de l'√©v√©nement" class="event-image-full">

    <div class="details-section">
        <p><strong>Description :</strong> {{ event.description }}</p>
        <p><strong>Lieu :</strong> {{ event.location }}</p>
        <p><strong>Date de d√©but :</strong> {{ event.startDate|date('d/m/Y H:i') }}</p>
        <p><strong>Date de fin :</strong> {{ event.endDate|date('d/m/Y H:i') }}</p>
        <p><strong>Cr√©√© par :</strong> {{ event.createdBy.username }}</p>
    </div>

    <div class="event-stats mt-3">
        <p><strong>Inscriptions :</strong> {{ registrations|length }} / {{ event.capacity }}</p>

        {% if registrations is not empty %}
            <h4>Participants inscrits :</h4>
            <ul class="participants-list">
                {% for registration in registrations %}
                    <li>
                        {{ registration.getUserId().username }}
                        {# üëá Le code √† v√©rifier attentivement. Utilisation de la notation simplifi√©e #}
                        {% if is_granted('ROLE_ADMIN') %}
                        <a href="{{ path('app_user_profile', {'id': registration.userId.id}) }}" class="btn-voir-profil ms-2">
                            Voir
                        </a>
                    {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Aucun participant inscrit pour le moment.</p>
        {% endif %}
    </div>

<div class="join-btn-container mt-4">
    {% if app.user %}
        {% if isRegistered %}
            <a href="{{ path('app_event_quit', {'id': event.id}) }}" class="btn btn-danger">Quitter l'√©v√©nement</a>
        {% else %}
            <a href="{{ path('app_event_join', {'id': event.id}) }}" class="btn btn-primary">Rejoindre l'√©v√©nement</a>
        {% endif %}
    {% else %}
        <p><a href="{{ path('app_login') }}">Connectez-vous</a> pour rejoindre cet √©v√©nement.</p>
    {% endif %}

{% if app.user and (event.createdBy == app.user or is_granted('ROLE_ADMIN')) %}
    <div class="admin-actions-container">
        <a href="{{ path('app_home') }}" class="square-btn square-btn-gray me-2">
            <img src="{{ asset('images/icones/return.svg') }}" alt="Retour" class="return-icon">
        </a>
        <a href="{{ path('app_event_edit', {'id': event.id}) }}" class="square-btn square-btn-yellow me-2">
            <img src="{{ asset('images/icones/edit.svg') }}" alt="Modifier" class="edit-icon">
        </a>
        <form method="post" action="{{ path('app_event_delete', {'id': event.id}) }}" onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer cet √©v√©nement ?');" style="display:inline-block;">
            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ event.id) }}">
            <button class="square-btn square-btn-red">
                <img src="{{ asset('images/icones/bin.svg') }}" alt="Supprimer" class="bin-icon">
            </button>
        </form>
    </div>
{% endif %}
</div>
</main>
{% endblock %}